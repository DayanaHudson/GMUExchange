<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link href="stylesheet.css" rel="stylesheet">
    <link href="search.css" rel="stylesheet">
    <link href="compatibility.css" rel="stylesheet">
    <script type = "text/javascript" src = "https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
    <script type = "text/javascript" src = "myjavascript.js"></script>
    <script src="https://unpkg.com/react@15.3.2/dist/react.js"></script>
    <script src="https://unpkg.com/react-dom@15.3.2/dist/react-dom.js"></script>
    <script src="https://unpkg.com/babel-core@5.8.38/browser.min.js"></script>
</head>
<body>
<script type = "text/babel">
    //starting point: https://facebook.github.io/react/docs/thinking-in-react.html
    var Results = React.createClass({
        render: function() {
            return (
                    <tr>
                        <td>{this.props.id}</td>
                        <td>{this.props.image}</td>
                        <td>{this.props.description}</td>
                        <td>{this.props.price}</td>
                        <td>Sample Seller Contact Info</td>
                    </tr>
            );
        }
    });
    /*
    var ActiveFilters = React.createClass({
        render: function() {
            return (
                    <table>
                        <tbody>
                        <tr>
                            <td><div className = "activeFilterItem">filter 1
                                <div className = "activeFilterDeselecter">x</div></div></td>
                            <td><div className = "activeFilterItem">filter 2
                                <div className = "activeFilterDeselecter">x</div></div></td>
                            <td><div className = "activeFilterItem">filter 3
                                <div className = "activeFilterDeselecter">x</div></div></td>
                        </tr>
                        </tbody>
                    </table>

            );
        }
    });

    var Filters = React.createClass({
        handleFilterChange: function(){
            console.log("filter changed filterClassText: "+this.refs.filterClassTextInput.value);
            this.props.onUserInput(
                    this.refs.filterClassTextInput.value,
                    //this.refs.filterProfessorTextInput.value,
                    //this.refs.filterPriceMaxInput.value,
                    //this.refs.filterDateInput.value
                    //this.refs.filterCategoryInput.value
            );
        },
        render: function() {
            console.log("filters filterClassText: "+this.props.filterClassText);
            //console.log("search box filterProfessorText: "+this.props.filterProfessorText);
            //console.log("search box filterPriceMax: "+this.props.filterPriceMax);
            //console.log("search box filterDate: "+this.props.filterDate);
            return (
                    <table>
                        <thead>
                        <tr><td>Category</td><td>Class</td><td>Professor</td><td>Maximum Price</td><td>Date</td></tr>
                        </thead>
                        <tbody><tr>
                            <td><select name="searchTermSelection">
                                <option name = "category" value="all">All</option>
                                <option name = "category" value="textbook">Textbook</option>
                                <option name = "category" value="classNotes">Class Notes</option>
                                <option name = "category" value="classMaterials">Class Materials</option>
                                <option name = "category" value="misc">Miscellaneous</option>
                            </select></td>
                            <td><input
                                    className = "input"
                                    type = "text"
                                    placeholder = "Search terms"
                                    value={this.props.filterClassText}
                                    ref="filterClassTextInput"
                                    onChange={this.handleFilterChange}
                                    id = "classSearchTermInput"
                            /></td>
                            <td><input
                                    className = "input"
                                    type = "text"
                                    placeholder = "Search terms"
                                    id = "professorSearchTermInput"
                            /></td>
                            <td><input
                                    type="range"
                                    min="0"
                                    max="10"
                                    id="priceSearchTermInput"
                            /><div id = "maxPriceDisplay">M.P.HERE</div></td>
                            <td><input
                                    className = "input"
                                    type = "text"
                                    placeholder = "Search terms"
                                    id = "dateSearchTermInput"/></td>
                        </tr>
                        </tbody>
                    </table>
            );
        }
    });
*/
    var SearchResultsTable = React.createClass({
        render: function() {
            //console.log("filterClassText1: "+this.props.filterClassText);
            var rows = [];
            this.props.items.forEach(function(item) {
                //console.log("filterClassText2: "+this.props.filterClassText);
                console.log("filterKeywordText: "+this.props.filterKeywordText);
                var regex = new RegExp('.*'+(this.props.filterKeywordText).toLowerCase()+'.*');
                var data = regex.exec((item.description).toLowerCase());
                console.log("data"+data);
                if ((data != null) || (this.props.filterClassText !== null && this.props.filterClassText === item.className)) {
                    rows.push(<Results id = {item.id} image = {item.image} description={item.description} price={item.price} key={item.id}/>);
                }
            }.bind(this));
            return (
                    <div className = "search" data-list-size="4">
                        <table className = "searchResultTable">
                            <thead>
                            <tr><th>ID</th><th>Image</th><th>Description</th><th>Price</th><th>Seller Contact</th></tr>
                            </thead>
                            <tbody>{rows}</tbody>
                        </table>
                    </div>
            );
        }
    });

/*Filter and Search button declaration; not needed since page automatically updates
 <td><button
 className = "button"
 id = "filterButton"
 >Filters</button></td>
 <td><button
 className = "button"
 id = "searchButton"
 >Search</button></td>

Referencing filters
 <div id = "searchFilters">
 <Filters/>
 </div>
* */
    var SearchBox = React.createClass({
        handleSearchBoxChange: function() {
            console.log("search box changed filterKeywordText: "+this.refs.filterKeywordTextInput.value);
            this.props.onUserInput(
                    this.refs.filterKeywordTextInput.value,
            );
        },
        //To add after the last </table> tag: <ActiveFilters/>
        render: function(){
            return (
            <div className = "search" data-list-size="4">
                <table className = "searchBoxTable">
                    <tbody>
                    <tr>
                        <td><input
                                className = "input"
                                type = "text"
                                placeholder = "Search by keywords"
                                value={this.props.filterKeywordText}
                                ref="filterKeywordTextInput"
                                onChange={this.handleSearchBoxChange}
                                id = "searchBox"
                        /></td>
                    </tr>
                    </tbody>
                </table>
            </div>
            );
        }
    });

    var FilterableSearchTable = React.createClass({
        getInitialState: function() {
            return {
                filterKeywordText: '',
                filterCategory: '',
                filterClassText: '',
                filterProfessorText: '',
                filterPriceMax: 0,
                filterDate: ''
            };
        },
        handleUserInput: function(filterKeywordText,filterCategory,filterClassText,filterProfessorText,filterPriceMax,filterDate) {
            this.setState({
                filterKeywordText: filterKeywordText,
                filterCategory: filterCategory,
                filterClassText: filterClassText,
                filterProfessorText: filterProfessorText,
                filterPriceMax: filterPriceMax,
                filterDate: filterDate
            });
        },
        render: function() {
            return (
                    <div>
                        <SearchBox
                                filterKeywordText={this.state.filterKeywordText}
                                filterCategory={this.state.filterCategory}
                                filterClassText={this.state.filterClassText}
                                filterProfessorText={this.state.filterProfessorText}
                                filterPriceMax={this.state.filterPriceMax}
                                filterDate={this.state.filterDate}
                                onUserInput={this.handleUserInput}
                        />
                        <SearchResultsTable
                                items={this.props.items}
                                filterKeywordText={this.state.filterKeywordText}
                                filterCategory={this.state.filterCategory}
                                filterClassText={this.state.filterClassText}
                                filterProfessorText={this.state.filterProfessorText}
                                filterPriceMax={this.state.filterPriceMax}
                                filterDate={this.state.filterDate}
                                onUserInput={this.handleUserInput}
                        />
                    </div>
            );
        }
    });


    var ITEMS = [{id: "1", image: "IMAGE1.jpg", isbn: "978-1305257795", description: "Research Methods and Statistics - 5th edition", price: "$144.48", category: "Textbook", className: "GEN 301", Professor: "Johnson", Date: "01/02/2016"},
        {id: "2", image: "IMAGE2.jpg", isbn: "978-1118345009", description: "Principles of Anatomy and Physiology -Text Only - 14th edition", price: "$150.96", category: "Textbook", className: "PHYS 240", Professor: "Smith", Date: "05/02/2016"},
        {id: "3", image: "IMAGE3.jpg", isbn: "978-1305632134", description: "Power System Analysis and Design - 6th edition", price: "$148.49", category: "Textbook", className: "GEN 301", Professor: "Marks", Date: "07/02/2016"},
        {id: "4", image: "IMAGE4.jpg", isbn: "978-0134201665", description: "Anatomy and Physiology - With Mastering A and P - 6th edition", price: "$249.90", category: "Textbook", className: "PHYS 100", Professor: "Walker", Date: "08/02/2016"},
        {id: "5", image: "IMAGE5.jpg", isbn: null, description: "Class notes for GEN 202", price: "$10.00", category: "ClassNotes", className: "GEN 301", Professor: "Johnson", Date: "01/02/2016"},
        {id: "6", image: "IMAGE6.jpg", isbn: null, description: "Class materials for ECE 301", price: "$25.00", category: "ClassMaterials", className: "ECE 301", Professor: "Johnson", Date: "01/02/2016"},
        {id: "7", image: "IMAGE7.jpg", isbn: null, description: "Desk and chair", price: "$40.00", category: "Misc", className: null, Professor: null, Date: "05/02/2016"},];


    ReactDOM.render(
            <FilterableSearchTable items={ITEMS} />,
            document.getElementById('container')
    );
</script>
<nav class = "menu">
    <ul>
        <li class = "left" id = "homeLink">Home</li>
        <li class = "left" id = "searchLink">Search</li>
        <li class = "left" id = "postLink">Post Item</li>
        <li class = "rightMenuLinks" id = "logInLink">Log In</li>
        <li class = "rightMenuLinks" id = "signUpLink">Sign Up</li>
        <li id = "logOut">Log Out</li>
        <!--last li element to be defined as username after successful login-->
        <li><span id = "userName"></span></li>
    </ul>
</nav>
<div class = "mainHeading">
    <h1 class = "title">GMUExchange</h1>
    <!--to be defined by home view's JS-->
    <h2 class = "subtitle"></h2>
    <!--Quick log in access-->
    <table class = "quickLogin">
        <tr>
            <th><input type = "email" placeholder = "GMU e-mail" id = "quickLoginEmail"/></th>
            <th><input type = "password" placeholder = "password" id = "quickLoginPassword"/></th>
        </tr>
        <tr>
            <td colspan = "2"><button class = "button" id = "quickLoginButton">Log In</button></td>
        </tr>
    </table>
    <!--Image labeled for reuse-->
    <img src="https://upload.wikimedia.org/wikipedia/commons/e/ea/An_aerial_view_of_the_Johnson_Center_at_dawn..jpg">
</div>
<div class = "sectionHeading">
    <h1 class = "title">GMUExchange</h1>
    <!--Subtitle to be defined by each view's JS-->
    <h2 class = "subtitle"  id = "subtitle">Search</h2>
    <!--Image labeled for reuse-->
    <img src="https://upload.wikimedia.org/wikipedia/commons/e/ea/An_aerial_view_of_the_Johnson_Center_at_dawn..jpg">
</div>
<div id="container">
    <!-- This element's contents will be replaced with your component. -->
</div>
</body>
<footer class = "footer">
    <h3>SWE 432</h3>
    <p>Dayana Hudson</p>
    <p>Ermal Dedej</p>
    <p><a href="https://github.com/dayanahudson/GMUExchange/">GitHub</a></p>
</footer>
</html>     